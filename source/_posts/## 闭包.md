---
title: 闭包
date: 2022-3-1
---

## 闭包

定义：闭包是指函数有权访问另一个函数中的变量
eg.

```javascript
let test2 = 2;
let closure = function closure() {
  let testClosure = 1;
  let test1 = () => {
    console.log("内部" + testClosure);
    console.log("内部" + test2);
  };
  return test1;
};
let result = closure();
result();
console.log("外部" + testClosure);
```

以上函数的输出就是 ‘内部 1’和’内部 2‘ ，因为 test1 可以访问 closure 的变量 testClosure 和再外部的 test2 而函数外部不允许，这就是闭包。本质上是连接了函数内部和外部。

### 闭包的作用

1. 闭包可以模拟模块

```javascript
function module() {
  let testNumber = 1;
  function increaseNumber() {
    testNumber++;
    return testNumber;
  }
  function decreaseNumber() {
    testNumber--;
    return testNumber;
  }
  function showNumber() {
    return testNumber;
  }
  return {
    increaseNumber,
    decreaseNumber,
    showNumber,
  };
}
let test = module();
console.log(test.showNumber());
console.log(test.increaseNumber());
console.log(test.decreaseNumber());
test.increaseNumber();
test.increaseNumber();
console.log(test.showNumber());
```

以上函数的输出是 1 2 1 3 2.用在块作用域上

```javascript
for (var i = 0; i < 5; i++) {
  (function (i) {
    setTimeout(function () {
      console.log(i);
    }, 1000);
  })(i);
}
```

以上函数的输出是 01234，可以实现和 let 一样的效果

### 闭包的优点

1. 函数嵌套函数，实现模块化
2. 内部函数可以使用外部函数的变量
3. 参数和变量不会被回收

### 闭包的缺点

1. 常驻内存，因为不会被回收
2. 使用不当容易内存泄露
